<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <base href="/"/>
    <title>Eloquent ORM - Laravel 开发笔记</title>
    <link rel="shortcut icon" type="image/x-icon" href="web/images/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="web/css/notes.css"/>
</head>
<body>
<main>
    <article>
        <h1>Eloquent ORM</h1>

        <h2>什么是 ORM</h2>
        <p>ORM 即 Object-Relational Mapping 对象关系映射，作用是在【关系型数据库】和【对象】之间建立映射，这样在处理对象时就不用和复杂的 SQL 语句打交道，只需操作对象的属性或方法。</p>
        <p>面向对象是从软件工程发展而来，而关系数据库是从数学理论发展而来，两者的发展路径不同。
            随着数据持久化成为软件项目的必然要素，为了让开发人员专注于业务，简化对数据的操作，ORM 应运而生。它的出现正是为了解决【面向对象】与【关系型数据库】之间存在的不匹配。</p>

        <h2>Laravel 的 ORM</h2>
        <p>Laravel 封装了一套自己的 ORM，有 Model、Relationships、Collection 几个主要概念，基本是围绕 Model 对数据进行操作。</p>

        <p>Laravel 的 Model 继承 <code>\Illuminate\Database\Eloquent\Model</code> 类，详情参考官网文档
            <a target="_blank" href="https://laravel.com/docs/5.5/eloquent">https://laravel.com/docs/5.5/eloquent</a>。
        </p>

        <p>Laravel 的 Collection 继承 <code>\Illuminate\Database\Eloquent\Collection</code> 类，详情参考官网文档
            <a target="_blank" href="https://laravel.com/docs/5.5/collections">https://laravel.com/docs/5.5/collections</a>。
        </p>

        <h3>数据库检索</h3>

        <p>下面整理了一些常见的数据库检索方法：</p>

        <p>以官网举的 Flight 类为例，可通过以下【静态方法】直接获得 Model：</p>
        <table class="list">
            <tr>
                <th><code>Flight::find($id, $columns = ['*'])</code></th>
                <td>根据指定 ID 检索数据库，失败时返回 <code>null</code></td>
            </tr>
            <tr>
                <th><code>Flight::findOrFail($id, $columns = ['*'])</code></th>
                <td>根据指定 ID 检索数据库，失败时抛出 <code>\Illuminate\Database\Eloquent\ModelNotFoundException</code></td>
            </tr>
            <tr>
                <th><code>Flight::findOrNew($id, $columns = ['*'])</code></th>
                <td>根据指定 ID 检索数据库，失败时返回空实例</td>
            </tr>
            <tr>
                <th><code>Flight::firstOrNew(array $attributes, array $values = [])</code></th>
                <td>根据 <code>$attributes</code> 数组检索数据库，失败时返回由 <code>$attributes</code> 及 <code>$values</code> 填充的新实例
                </td>
            </tr>
            <tr>
                <th><code>Flight::firstOrCreate(array $attributes, array $values = [])</code></th>
                <td>根据 <code>$attributes</code> 数组检索数据库，失败时返回由 <code>$attributes</code> 及 <code>$values</code>
                    填充的新实例，并创建一条对应的数据库记录
                </td>
            </tr>
            <tr>
                <th><code>Flight::create(array $attributes = [])</code></th>
                <td>为数据库创建一条由 <code>$attributes</code> 填充的新纪录，并返回对应实例</td>
            </tr>
            <tr>
                <th><code>Flight::updateOrCreate(array $attributes, array $values = [])</code></th>
                <td>根据 <code>$attributes</code> 数组检索数据库，找到结果则以 <code>$values</code> 进行更新，否则创建一条由
                    <code>$attributes</code> 及 <code>$values</code> 填充的新纪录
                </td>
            </tr>
        </table>

        <p>可通过以下【静态方法】直接获得 Collection：</p>
        <table class="list">
            <tr>
                <th><code>Flight::all($columns = ['*'])</code></th>
                <td>检索所有数据库记录</td>
            </tr>
        </table>

        <p>可通过以下【静态方法】生成 Query，再由其 <code>get</code> 方法获得 Collection：</p>
        <table class="list">
            <tr>
                <th><code>Flight::where($column, $operator = null, $value = null, $boolean = 'and')</code></th>
                <td>根据字段 <code>$column</code>、条件 <code>$operator</code>、值 <code>$value</code> 检索数据库</td>
            </tr>
        </table>

        <p>可通过 Collection 的以下方法获得 Model：</p>
        <table class="list">
            <tr>
                <th><code>firstOrFail($columns = ['*'])</code></th>
                <td>返回第一个符合条件的结果，找不到数据时抛出 <code>\Illuminate\Database\Eloquent\ModelNotFoundException</code></td>
            </tr>
            <tr>
                <th><code>firstOr($columns = ['*'], Closure $callback = null)</code></th>
                <td>返回第一个符合条件的结果，找不到数据时执行 <code>$callback</code></td>
            </tr>
        </table>

    </article>
</main>
<script src="web/js/lib/require.js" type="text/javascript"></script>
<script src="web/js/require-config.js" type="text/javascript"></script>
<script src="web/js/notes.js" type="text/javascript"></script>
</body>
</html>